<%- include('../partials/html.ejs') %>

<head>
    <%- include("../partials/title-meta.ejs", {title: "User Profile"}) %>

    <%- include('../partials/head-css.ejs') %>
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">

        <%- include('../partials/menu.ejs') %>

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->
        <div class="page-content">

            <div class="page-container">

                <%- include("../partials/page-title.ejs", {subtitle:"Account", title:"User Profile"}) %>

                <div class="row">
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="pt-2 pb-2">
                                    <% if (user.profile_image) { %>
                                        <img src="<%= user.profile_image %>" alt="profile-image" class="rounded-circle avatar-xl">
                                    <% } else { %>
                                        <div class="rounded-circle avatar-xl d-inline-flex align-items-center justify-content-center bg-primary text-white fs-1">
                                            <%= user.first_name.charAt(0) %><%= user.last_name.charAt(0) %>
                                        </div>
                                    <% } %>
                                </div>
                                <h4 class="mt-3 mb-0"><%= user.first_name %> <%= user.last_name %></h4>
                                <p class="text-muted"><%= user.Roles[0].name.charAt(0).toUpperCase() + user.Roles[0].name.slice(1) %></p>
                                
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-8">
                        <%- include('../partials/alert.ejs') %>
                        <div class="card">
                            <div class="card-body">
                                <ul class="nav nav-tabs nav-bordered" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#profile-details" role="tab">Account Details</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#profile-activity" role="tab">Recent Activity</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#profile-settings" role="tab">Settings</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="profile-details">
                                        <h5 class="mt-3">User Information</h5>
                                        <div class="table-responsive">
                                            <table class="table table-borderless mb-0">
                                                <tbody>
                                                    <tr>
                                                        <th scope="row">Full Name</th>
                                                        <td><%= user.first_name %> <%= user.last_name %></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Role</th>
                                                        <td><%= user.Roles[0].name.charAt(0).toUpperCase() + user.Roles[0].name.slice(1) %> - <%= user.Roles[0].description %></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Email</th>
                                                        <td><%= user.email %></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Phone</th>
                                                        <td><%= user.phone %></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Account Status</th>
                                                        <td><span class="badge bg-success"><%= user.status.charAt(0).toUpperCase() + user.status.slice(1) %></span></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Account Created</th>
                                                        <td><%= new Date(user.created_at).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Last Login</th>
                                                        <td><%= new Date(user.last_login).toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="profile-activity">
                                        <h5 class="mt-3">Recent Activity</h5>
                                        <div class="timeline-alt pb-0">
                                            <div class="timeline-item">
                                                <i class="mdi mdi-login bg-info-lighten text-info timeline-icon"></i>
                                                <div class="timeline-item-info">
                                                    <h5 class="mt-0 mb-1">Logged In</h5>
                                                    <p class="font-14">
                                                        Successfully logged in to the system
                                                        <small class="text-muted"><%= new Date(user.last_login).toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></small>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="timeline-item">
                                                <i class="mdi mdi-account-edit bg-primary-lighten text-primary timeline-icon"></i>
                                                <div class="timeline-item-info">
                                                    <h5 class="mt-0 mb-1">Profile Updated</h5>
                                                    <p class="font-14">
                                                        Account information was updated
                                                        <small class="text-muted"><%= new Date(user.updated_at).toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></small>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="timeline-item">
                                                <i class="mdi mdi-account-check bg-success-lighten text-success timeline-icon"></i>
                                                <div class="timeline-item-info">
                                                    <h5 class="mt-0 mb-1">Account Created</h5>
                                                    <p class="font-14">
                                                        User account was successfully created
                                                        <small class="text-muted"><%= new Date(user.created_at).toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></small>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="profile-settings">
                                        <h5 class="mt-3 mb-3">Account Settings</h5>
                                        <!-- Fix for the Update Profile Form in profile.ejs -->
                                         
                                        <form action="/profile" method="POST" enctype="multipart/form-data">
                                            <!-- Hidden field for method override if needed -->
                                            <input type="hidden" name="_method" value="PUT">

                                            <div class="row mb-3">
                                                <label for="inputFirstName" class="col-sm-3 col-form-label">First Name</label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control" id="inputFirstName" name="first_name" value="<%= user.first_name %>">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label for="inputLastName" class="col-sm-3 col-form-label">Last Name</label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control" id="inputLastName" name="last_name" value="<%= user.last_name %>">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label for="inputEmail" class="col-sm-3 col-form-label">Email</label>
                                                <div class="col-sm-9">
                                                    <input type="email" class="form-control" id="inputEmail" name="email" value="<%= user.email %>">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label for="inputPhone" class="col-sm-3 col-form-label">Phone</label>
                                                <div class="col-sm-9">
                                                    <input type="text" class="form-control" id="inputPhone" name="phone" value="<%= user.phone || '' %>">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label for="inputProfileImage" class="col-sm-3 col-form-label">Profile Image</label>
                                                <div class="col-sm-9">
                                                    <input type="file" class="form-control" name="profile_image" id="inputProfileImage">
                                                    <div class="form-text">Supported formats: JPG, PNG, GIF</div>
                                                </div>
                                            </div>
                                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                                <button type="button" class="btn btn-light me-md-2" data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                            </div>
                                        </form>

                                        <hr>

                                        <h5 class="mt-4 mb-3">Security Settings</h5>
                                        <form action="/change-password" method="post">
                                            <div class="row mb-3">
                                                <label for="inputCurrentPassword" class="col-sm-3 col-form-label">Current Password</label>
                                                <div class="col-sm-9">
                                                    <input type="password" class="form-control" id="inputCurrentPassword" name="current_password" placeholder="Enter current password">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label for="inputNewPassword" class="col-sm-3 col-form-label">New Password</label>
                                                <div class="col-sm-9">
                                                    <input type="password" class="form-control" id="inputNewPassword" name="new_password" placeholder="Enter new password">
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                                <label for="inputConfirmPassword" class="col-sm-3 col-form-label">Confirm Password</label>
                                                <div class="col-sm-9">
                                                    <input type="password" class="form-control" id="inputConfirmPassword" name="confirm_password" placeholder="Confirm new password">
                                                </div>
                                            </div>
                                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                                <button type="button" class="btn btn-light me-md-2">Cancel</button>
                                                <button type="submit" class="btn btn-primary">Update Password</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- end row -->

            </div> <!-- container -->

            <%- include('../partials/footer.ejs') %>

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->

    <%- include('../partials/customizer.ejs') %>

    <%- include('../partials/footer-scripts.ejs') %>

    <!--Morris Chart-->
    <script src="/admin/libs/morris.js/morris.min.js"></script>
    <script src="/admin/libs/raphael/raphael.min.js"></script>

    

</body>

</html>