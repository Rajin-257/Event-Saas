<%- include('../partials/html') %>

<head>
    <%- include('../partials/title-meta') %>
    <%- include('../partials/head-css') %>
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">

        <%- include('../partials/menu') %>

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->
        <div class="page-content">
            <div class="page-container">

                <div class="row">
                    <div class="col-12">
                        <div class="page-title-head d-flex align-items-sm-center flex-sm-row flex-column">
                            <div class="flex-grow-1">
                                <h4 class="fs-18 text-uppercase fw-bold m-0">My Profile</h4>
                            </div>
                        </div><!-- end card header -->
                    </div>
                    <!--end col-->
                </div> <!-- end row-->

                <!-- Flash Messages -->
                <%- include('../partials/messages') %>

                <div class="row">
                    <!-- Profile Information Column -->
                    <div class="col-xl-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="text-center mb-4">
                                    <% if (user.profileImage) { %>
                                    <img src="<%= user.profileImage %>" alt="Profile Image" class="rounded-circle avatar-xl">
                                    <% } else { %>
                                    <div class="avatar-xl mx-auto bg-primary-subtle rounded-circle d-flex align-items-center justify-content-center">
                                        <span class="avatar-title text-primary fs-24">
                                            <%= user.name.charAt(0).toUpperCase() %>
                                        </span>
                                    </div>
                                    <% } %>
                                    <h4 class="mt-3 mb-1"><%= user.name %></h4>
                                    <p class="text-muted"><%= user.role || 'User' %></p>
                                </div>

                                <div>
                                    <h5 class="fs-14 mb-3">Account Information</h5>
                                    <div class="d-flex align-items-center py-2">
                                        <div class="flex-shrink-0 me-2">
                                            <i class="ti ti-calendar fs-18 text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <p class="mb-0">Joined: <%= new Date(user.createdAt).toLocaleDateString() %></p>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center py-2">
                                        <div class="flex-shrink-0 me-2">
                                            <i class="ti ti-shield-check fs-18 text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <p class="mb-0">Status: 
                                                <% if (user.status === 'active') { %>
                                                <span class="badge bg-success">Active</span>
                                                <% } else if (user.status === 'inactive') { %>
                                                <span class="badge bg-warning">Inactive</span>
                                                <% } else if (user.status === 'blocked') { %>
                                                <span class="badge bg-danger">Blocked</span>
                                                <% } else { %>
                                                <span class="badge bg-secondary">Unknown</span>
                                                <% } %>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <% if (user.walletBalance !== undefined) { %>
                                <div class="mt-4">
                                    <h5 class="fs-14 mb-3">Wallet</h5>
                                    <div class="card bg-light">
                                        <div class="card-body p-3">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0 me-1">
                                                    <i class="ti ti-wallet fs-24 text-primary"></i>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h6 class="mb-2">Balance</h6>
                                                    <h4 class="mb-0">$<%= parseFloat(user.walletBalance).toFixed(2) %></h4>
                                                </div>
                                                <a href="/wallet/topup" class="btn btn-sm btn-primary">Withdraw</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                            </div>
                        </div>
                        
                        <!-- Verification Status -->
                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title">Account Verification</h5>
                                
                                <div class="d-flex align-items-center mb-4">
                                    <div class="me-3">
                                        <% if (user.verified) { %>
                                        <span class="badge bg-success p-2">
                                            <i class="ti ti-rosette-discount-check fs-16"></i>
                                        </span>
                                        <% } else { %>
                                        <span class="badge bg-warning p-2">
                                            <i class="ti ti-clock-exclamation fs-16"></i>
                                        </span>
                                        <% } %>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Email Verification</h6>
                                        <p class="mb-0 text-muted">
                                            <% if (user.verified) { %>
                                            Your email has been verified
                                            <% } else { %>
                                            Your email is not verified
                                            <a href="/resend-verification-link/<%= user.email %>" class="btn btn-sm btn-link p-0 ms-2 text-danger">Resend verification</a>
                                            <% } %>
                                        </p>
                                    </div>
                                </div>
                                
                                <% if (user.referralCode) { %>
                                <div class="mt-3">
                                    <h6 class="mb-2">Your Referral Code</h6>
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="<%= user.referralCode %>" id="referralCode" readonly>
                                        <button class="btn btn-outline-primary" type="button" onclick="copyReferralCode()">
                                            <i class="ti ti-copy"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">Share this code with your friends</small>
                                </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <!-- End Profile Information Column -->

                    <!-- Edit Profile Column -->
                    <div class="col-xl-8">
                        <div class="card">
                            <div class="card-header d-flex align-items-center">
                                <h4 class="header-title flex-grow-1">Account Settings</h4>
                                <ul class="nav nav-tabs nav-bordered card-header-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#edit-profile" role="tab">Profile</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#change-password" role="tab">Password</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <div class="tab-content">
                                    <!-- Edit Profile Tab -->
                                    <div class="tab-pane show active" id="edit-profile">
                                        <form action="/users/profile" method="POST" enctype="multipart/form-data">
                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="profileImage" class="form-label">Profile Image</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-grow-1">
                                                            <input type="file" class="form-control" id="profileImage" name="profileImage">
                                                            <small class="text-muted">Recommended size: 300x300px</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="name" class="form-label">Full Name</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>" required>
                                                </div>
                                            </div>

                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="email" class="form-label">Email Address</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <input type="email" class="form-control" id="email" name="email" value="<%= user.email %>" required readonly>
                                                </div>
                                            </div>

                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="phone" class="form-label">Phone Number</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <input type="tel" class="form-control" id="phone" name="phone" value="<%= user.phone || '' %>">
                                                </div>
                                            </div>

                                            <div class="text-end">
                                                <button type="submit" class="btn btn-primary">Update Profile</button>
                                            </div>
                                        </form>
                                    </div>
                                    <!-- End Edit Profile Tab -->
                                    
                                    <!-- Change Password Tab -->
                                    <div class="tab-pane" id="change-password">
                                        <form action="/users/change-password" method="POST">
                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="currentPassword" class="form-label">Current Password</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                                                </div>
                                            </div>

                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="newPassword" class="form-label">New Password</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                                                    <small class="text-muted">Password must be at least 6 characters</small>
                                                </div>
                                            </div>

                                            <div class="row mb-3">
                                                <div class="col-lg-3">
                                                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                                                </div>
                                                <div class="col-lg-9">
                                                    <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                                </div>
                                            </div>

                                            <div class="text-end">
                                                <button type="submit" class="btn btn-primary">Change Password</button>
                                            </div>
                                        </form>
                                    </div>
                                    <!-- End Change Password Tab -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Activity Log -->
                        <div class="card mt-4">
                            <div class="card-header d-flex align-items-center">
                                <h5 class="card-title mb-0 flex-grow-1">Recent Activity</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="p-3">
                                    <div class="timeline-alt pb-0">
                                        <div class="timeline-item">
                                            <i class="timeline-icon bg-info-subtle text-info">
                                                <i class="ti ti-login-2 fs-16"></i>
                                            </i>
                                            <div class="timeline-item-info">
                                                <a href="#" class="text-info fw-bold mb-1 d-block">Login</a>
                                                <small>Logged in Time</small>
                                                <p class="mb-0 pb-2">
                                                    <small class="text-muted">
                                                        <%= user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'N/A' %>
                                                    </small>
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div class="timeline-item">
                                            <i class="timeline-icon bg-info-subtle text-warning">
                                                <i class="ti ti-login-2 fs-16"></i>
                                            </i>
                                            <div class="timeline-item-info">
                                                <a href="#" class="text-warning fw-bold mb-1 d-block">Updated</a>
                                                <small>Updated Time</small>
                                                <p class="mb-0 pb-2">
                                                    <small class="text-muted">
                                                        <%= new Date(user.updatedAt).toLocaleString() %>
                                                    </small>
                                                </p>
                                            </div>
                                        </div>

                                        <div class="timeline-item">
                                            <i class="timeline-icon bg-primary-subtle text-primary">
                                                <i class="ti ti-user-check fs-16"></i>
                                            </i>
                                            <div class="timeline-item-info">
                                                <a href="#" class="text-primary fw-bold mb-1 d-block">Account Created</a>
                                                <small>Your account was successfully created</small>
                                                <p class="mb-0 pb-2">
                                                    <small class="text-muted">
                                                        <%= new Date(user.createdAt).toLocaleString() %>
                                                    </small>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Edit Profile Column -->
                </div> <!-- end row-->

            </div> <!-- container -->

            <%- include('../partials/footer') %>

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->

    <%- include('../partials/customizer') %>
    <%- include('../partials/footer-scripts') %>

    <script>
        function copyReferralCode() {
            const referralCode = document.getElementById('referralCode');
            referralCode.select();
            referralCode.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(referralCode.value);
            
            // Show toast notification
            const toast = document.createElement('div');
            toast.className = 'position-fixed top-50 start-50 translate-middle bg-success text-white p-2 rounded';
            toast.style.zIndex = '9999';
            toast.textContent = 'Referral code copied!';
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }
    </script>

</body>

</html>