<%- include('../partials/html.ejs') %>

<head>
    <%- include("../partials/title-meta.ejs", {title: "Event Management"}) %>

    <link rel="stylesheet" href="/backend/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-select-bs5/css/select.bootstrap5.min.css">
    <!-- Flatpickr for better date/time selection -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css">

    <%- include('../partials/head-css.ejs') %>

    <style>
        /* Custom styles for date and time pickers */
        .flatpickr-input {
            background-color: #fff;
        }
        .date-time-container {
            position: relative;
        }
        .date-time-container i {
            position: absolute;
            right: 10px;
            top: 10px;
            color: #6c757d;
        }
        .date-time-picker {
            cursor: pointer;
            background-color: #fff !important;
        }
        .time-display {
            display: inline-block;
            min-width: 65px;
        }
        
        /* Table responsiveness improvements */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Control column widths */
        #responsive-datatable th.title-column,
        #responsive-datatable td.title-column {
            max-width: 150px;
            min-width: 100px;
        }
        
        #responsive-datatable th.date-column,
        #responsive-datatable td.date-column {
            width: 90px;
            min-width: 90px;
        }
        
        #responsive-datatable th.time-column,
        #responsive-datatable td.time-column {
            width: 80px;
            min-width: 80px;
        }
        
        #responsive-datatable th.location-column,
        #responsive-datatable td.location-column {
            max-width: 120px;
            min-width: 100px;
        }
        
        #responsive-datatable th.host-column,
        #responsive-datatable td.host-column {
            max-width: 120px;
            min-width: 100px;
        }
        
        #responsive-datatable th.speaker-column,
        #responsive-datatable td.speaker-column {
            max-width: 120px;
            min-width: 100px;
        }
        
        #responsive-datatable th.topic-column,
        #responsive-datatable td.topic-column {
            max-width: 150px;
            min-width: 120px;
        }
        
        #responsive-datatable th.action-column,
        #responsive-datatable td.action-column {
            width: 110px;
            min-width: 110px;
        }
        
        /* Add text truncation with ellipsis for long content */
        #responsive-datatable td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Add tooltip-like behavior on hover for truncated content */
        #responsive-datatable td.has-tooltip {
            position: relative;
        }
        
        #responsive-datatable td.has-tooltip:hover::after {
            content: attr(data-full-text);
            position: absolute;
            left: 0;
            top: 100%;
            z-index: 5;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 8px;
            white-space: normal;
            max-width: 300px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">

        <%- include('../partials/menu.ejs', {user: formData}) %>

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="page-content">

            <div class="page-container">

                <%- include("../partials/page-title.ejs", {subtitle:"Management", title:"Event Directory"}) %>

                <%- include("../partials/validation-message.ejs") %>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-xl-9">
                                        <h5 class="card-title">Event Management</h5>
                                        <p class="card-subtitle">
                                            Manage scheduled events, times, locations, and assigned speakers.
                                        </p>
                                    </div>
                                    <div class="col-xl-3">
                                        <div class="card-body">
                                            <button class="btn btn-primary w-100" id="btn-add-event">
                                                <i class="ti ti-plus me-2 align-middle"></i> Add Event
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="card-body pt-2">
                                <!-- Added table-responsive wrapper -->
                                <div class="table-responsive">
                                    <table id="responsive-datatable" class="table table-bordered dt-responsive nowrap" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th class="title-column">Event Title</th>
                                                <th class="date-column">Date</th>
                                                <th class="time-column">Time</th>
                                                <th class="location-column">Location</th>
                                                <th class="host-column">Hosted By</th>
                                                <th class="speaker-column">Guest Speaker</th>
                                                <th class="topic-column">Topic</th>
                                                <th class="action-column">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% events.forEach(function(event) { %>
                                                <tr data-event='<%= JSON.stringify(event).replace(/'/g, "&#39;") %>'>
                                                    <td class="title-column has-tooltip" data-full-text="<%= event.event_title %>"><%= event.event_title %></td>
                                                    <td class="date-column"><%= event.date %></td>
                                                    <td class="time-column"><%= event.time %></td>
                                                    <td class="location-column has-tooltip" data-full-text="<%= event.event_location %>"><%= event.event_location %></td>
                                                    <td class="host-column has-tooltip" data-full-text="<%= event.hosted_by %>"><%= event.hosted_by %></td>
                                                    <td class="speaker-column has-tooltip" data-full-text="<%= event.Guest ? event.Guest.name : 'No guest speaker' %>"><%= event.Guest ? event.Guest.name : 'No guest speaker' %></td>
                                                    <td class="topic-column has-tooltip" data-full-text="<%= event.guest_topic || '-' %>"><%= event.guest_topic || '-' %></td>
                                                    <td class="action-column">
                                                        <div class="btn-group" role="group">
                                                            <button class="btn btn-primary btn-sm btn-edit-event" data-event-id="<%= event.id %>">
                                                                <i class="mdi mdi-pencil"></i>
                                                            </button>
                                                            <button type="button" class="btn btn-danger btn-sm ms-1 btn-event-delete" data-event-id="<%= event.id %>">
                                                                <i class="mdi mdi-delete"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- end row -->

                <!-- Add New Event MODAL -->
                <div class="modal fade" id="event-modal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <form action="/settings/events/create" id="event-form" class="needs-validation" novalidate method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title" id="event-modal-title">
                                        Add New Event
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="event-title" class="form-label">Event Title</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="event-title" 
                                                  name="event_title" 
                                                  placeholder="Enter event title"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide an event title</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="event-location" class="form-label">Location</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="event-location" 
                                                  name="event_location" 
                                                  placeholder="Enter event location"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide an event location</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="event-date" class="form-label">Date</label>
                                                <div class="date-time-container">
                                                    <input 
                                                      type="text" 
                                                      class="form-control date-time-picker" 
                                                      id="event-date" 
                                                      name="date" 
                                                      placeholder="Select date"
                                                      required
                                                    >
                                                    <i class="ti ti-calendar"></i>
                                                    <div class="invalid-feedback">Please select a date</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="event-time" class="form-label">Time</label>
                                                <div class="date-time-container">
                                                    <input 
                                                      type="text" 
                                                      class="form-control date-time-picker" 
                                                      id="event-time" 
                                                      name="time" 
                                                      placeholder="Select time"
                                                      required
                                                    >
                                                    <i class="ti ti-clock"></i>
                                                    <div class="invalid-feedback">Please select a time</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="event-host" class="form-label">Hosted By</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="event-host" 
                                                  name="hosted_by" 
                                                  placeholder="Enter host name or organization"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide a host</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="event-guest" class="form-label">Guest Speaker (Optional)</label>
                                                <select 
                                                  class="form-select" 
                                                  id="event-guest" 
                                                  name="guest_id"
                                                >
                                                  <option value="">Select Guest Speaker (Optional)</option>
                                                  <% guests.forEach(function(guest) { %>
                                                    <option value="<%= guest.id %>"><%= guest.name %> - <%= guest.organization || guest.designation || 'No title' %></option>
                                                  <% }); %>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="event-topic" class="form-label">Guest Topic (Optional)</label>
                                                <textarea 
                                                  class="form-control" 
                                                  id="event-topic" 
                                                  name="guest_topic" 
                                                  rows="3"
                                                  placeholder="Enter the topic the guest will present"
                                                ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Save Event
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end event modal-->

                <!-- Edit Event MODAL -->
                <div class="modal fade" id="edit-event-modal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <form action="/settings/events/update/" id="edit-event-form" class="needs-validation" novalidate method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title">
                                        Edit Event
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <input type="hidden" name="id" id="edit-event-id">
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-event-title" class="form-label">Event Title</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="edit-event-title" 
                                                  name="event_title" 
                                                  placeholder="Enter event title"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide an event title</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-event-location" class="form-label">Location</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="edit-event-location" 
                                                  name="event_location" 
                                                  placeholder="Enter event location"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide an event location</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-event-date" class="form-label">Date</label>
                                                <div class="date-time-container">
                                                    <input 
                                                      type="text" 
                                                      class="form-control date-time-picker" 
                                                      id="edit-event-date" 
                                                      name="date" 
                                                      placeholder="Select date"
                                                      required
                                                    >
                                                    <i class="ti ti-calendar"></i>
                                                    <div class="invalid-feedback">Please select a date</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-event-time" class="form-label">Time</label>
                                                <div class="date-time-container">
                                                    <input 
                                                      type="text" 
                                                      class="form-control date-time-picker" 
                                                      id="edit-event-time" 
                                                      name="time" 
                                                      placeholder="Select time"
                                                      required
                                                    >
                                                    <i class="ti ti-clock"></i>
                                                    <div class="invalid-feedback">Please select a time</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-event-host" class="form-label">Hosted By</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="edit-event-host" 
                                                  name="hosted_by" 
                                                  placeholder="Enter host name or organization"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide a host</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-event-guest" class="form-label">Guest Speaker (Optional)</label>
                                                <select 
                                                  class="form-select" 
                                                  id="edit-event-guest" 
                                                  name="guest_id"
                                                >
                                                  <option value="">Select Guest Speaker (Optional)</option>
                                                  <% guests.forEach(function(guest) { %>
                                                    <option value="<%= guest.id %>"><%= guest.name %> - <%= guest.organization || guest.designation || 'No title' %></option>
                                                  <% }); %>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="edit-event-topic" class="form-label">Guest Topic (Optional)</label>
                                                <textarea 
                                                  class="form-control" 
                                                  id="edit-event-topic" 
                                                  name="guest_topic" 
                                                  rows="3"
                                                  placeholder="Enter the topic the guest will present"
                                                ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Update Event
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end edit event modal-->

                <!-- Delete Event MODAL -->
                <div class="modal fade" id="delete-event-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/settings/events/delete/" id="delete-event-form" method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title">
                                        Delete Event
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <input type="hidden" name="id" id="delete-event-id">
                                    <div class="alert alert-danger" role="alert">
                                        <div class="d-flex align-items-center">
                                            <i class="ti ti-alert-triangle me-2 fs-3"></i>
                                            <div>
                                                <h5 class="alert-heading mb-1">Warning: Deletion Confirmation</h5>
                                                <p class="mb-0">Are you sure you want to delete this event? This action cannot be undone.</p>
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light me-auto" data-bs-dismiss="modal">
                                            Cancel
                                        </button>
                                        <button type="submit" class="btn btn-danger">
                                            <i class="ti ti-trash me-1"></i> Yes, Delete
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end delete event modal-->

            </div> <!-- container -->

            <%- include('../partials/footer.ejs') %>
            
        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->

    <%- include('../partials/customizer.ejs') %>

    <%- include('../partials/footer-scripts.ejs') %>

    <!-- Datatable plugin js -->
    <script src="/backend/libs/datatables.net/js/dataTables.min.js"></script>
    <script src="/backend/libs/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
    <script src="/backend/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="/backend/libs/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="/backend/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="/backend/libs/datatables.net-select/js/dataTables.select.min.js"></script>
    
    <!-- Flatpickr - Better date/time picker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>

    <!-- Datatables init -->
    <script src="/backend/js/pages/table-datatable.js"></script>
    
    <!-- Event management scripts -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize datatables with responsive configuration
        $('#responsive-datatable').DataTable({
            responsive: true,
            scrollX: true,
            autoWidth: false,
            columnDefs: [
                { width: '150px', targets: 0 }, // Event Title
                { width: '90px', targets: 1 },  // Date
                { width: '80px', targets: 2 },  // Time
                { width: '120px', targets: 3 }, // Location
                { width: '120px', targets: 4 }, // Hosted By
                { width: '120px', targets: 5 }, // Guest Speaker
                { width: '150px', targets: 6 }, // Topic
                { width: '110px', targets: 7 }  // Action
            ],
            lengthMenu: [10, 25, 50, 100]
        });
        
        // Initialize flatpickr for date pickers
        flatpickr("#event-date", {
            dateFormat: "Y-m-d",
            allowInput: true,
            animate: true
        });
        
        flatpickr("#edit-event-date", {
            dateFormat: "Y-m-d",
            allowInput: true,
            animate: true
        });
        
        // Initialize flatpickr for time pickers
        flatpickr("#event-time", {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true,
            minuteIncrement: 15,
            allowInput: true,
            animate: true
        });
        
        flatpickr("#edit-event-time", {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true,
            minuteIncrement: 15,
            allowInput: true,
            animate: true
        });
        
        // Add Event button functionality
        document.getElementById('btn-add-event').addEventListener('click', function() {
            var eventModal = new bootstrap.Modal(document.getElementById('event-modal'));
            eventModal.show();
        });
        
        // Edit Event button functionality
        document.querySelectorAll('.btn-edit-event').forEach(button => {
            button.addEventListener('click', function() {
                const eventId = this.getAttribute('data-event-id');
                // Find the parent row that contains the event data
                const eventRow = this.closest('tr');
                const eventData = JSON.parse(eventRow.getAttribute('data-event'));
                
                if (eventData) {
                    // Set form action URL
                    document.getElementById('edit-event-form').action = `/settings/events/update/${eventId}`;
                    
                    // Populate form fields
                    document.getElementById('edit-event-id').value = eventData.id;
                    document.getElementById('edit-event-title').value = eventData.event_title;
                    document.getElementById('edit-event-location').value = eventData.event_location;
                    document.getElementById('edit-event-date').value = eventData.date;
                    document.getElementById('edit-event-time').value = eventData.time;
                    document.getElementById('edit-event-host').value = eventData.hosted_by;
                    document.getElementById('edit-event-guest').value = eventData.guest_id || '';
                    document.getElementById('edit-event-topic').value = eventData.guest_topic || '';
                    
                    // Reinitialize the date and time pickers
                    const datePicker = document.getElementById('edit-event-date')._flatpickr;
                    if (datePicker) {
                        datePicker.setDate(eventData.date);
                    }
                    
                    const timePicker = document.getElementById('edit-event-time')._flatpickr;
                    if (timePicker) {
                        timePicker.setDate(eventData.time);
                    }
                    
                    // Show modal
                    var editModal = new bootstrap.Modal(document.getElementById('edit-event-modal'));
                    editModal.show();
                } else {
                    // Fallback to the AJAX approach if data attributes aren't available
                    fetch(`/settings/events/${eventId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                const event = data.data;
                                
                                // Set form action URL
                                document.getElementById('edit-event-form').action = `/settings/events/update/${eventId}`;
                                
                                // Populate form fields
                                document.getElementById('edit-event-id').value = event.id;
                                document.getElementById('edit-event-title').value = event.event_title;
                                document.getElementById('edit-event-location').value = event.event_location;
                                document.getElementById('edit-event-date').value = event.date;
                                document.getElementById('edit-event-time').value = event.time;
                                document.getElementById('edit-event-host').value = event.hosted_by;
                                document.getElementById('edit-event-guest').value = event.guest_id || '';
                                document.getElementById('edit-event-topic').value = event.guest_topic || '';
                                
                                // Reinitialize the date and time pickers
                                const datePicker = document.getElementById('edit-event-date')._flatpickr;
                                if (datePicker) {
                                    datePicker.setDate(event.date);
                                }
                                
                                const timePicker = document.getElementById('edit-event-time')._flatpickr;
                                if (timePicker) {
                                    timePicker.setDate(event.time);
                                }
                                
                                // Show modal
                                var editModal = new bootstrap.Modal(document.getElementById('edit-event-modal'));
                                editModal.show();
                            } else {
                                alert('Error loading event details');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Failed to load event details');
                        });
                }
            });
        });
        
        // Delete Event button functionality
        document.querySelectorAll('.btn-event-delete').forEach(button => {
            button.addEventListener('click', function() {
                const eventId = this.getAttribute('data-event-id');
                // Set delete form action URL
                document.getElementById('delete-event-form').action = `/settings/events/delete/${eventId}`;
                document.getElementById('delete-event-id').value = eventId;
                
                // Show delete confirmation modal
                var deleteModal = new bootstrap.Modal(document.getElementById('delete-event-modal'));
                deleteModal.show();
            });
        });
        
        // Form validation
        const forms = document.querySelectorAll('.needs-validation');
        
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                form.classList.add('was-validated');
            }, false);
        });
        
        // Add tooltips for long text content on hover
        document.querySelectorAll('.has-tooltip').forEach(cell => {
            // Make sure the tooltip is only shown when the text is actually truncated
            const isOverflowing = cell.scrollWidth > cell.clientWidth;
            if (isOverflowing) {
                cell.style.cursor = 'help';
            }
        });
        
        // Handle window resize to properly adjust table layout
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                // Redraw the datatable to adjust column widths when window size changes
                $('#responsive-datatable').DataTable().columns.adjust().draw();
            }, 250);
        });
      });
    </script>
</body>
</html>