<%- include('../partials/html.ejs') %>

<head>
    <%- include("../partials/title-meta.ejs", {title: "User's"}) %>

    <link rel="stylesheet" href="/backend/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-select-bs5/css/select.bootstrap5.min.css">

    <%- include('../partials/head-css.ejs') %>
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">

        <%- include('../partials/menu.ejs') %>

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="page-content">

            <div class="page-container">

                <%- include("../partials/page-title.ejs", {subtitle:"Tables", title:"User's Tables"}) %>

                <%- include("../partials/validation-message.ejs", {subtitle:"Tables", title:"User's Tables"}) %>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-xl-9">
                                        <h5 class="card-title">Responsive example</h5>
                                        <p class="card-subtitle">
                                            Responsive is an extension for DataTables that resolves that problem by optimising the table's layout for different screen sizes through the dynamic insertion and removal of columns from the table.
                                        </p>
                                    </div>
                                    <div class="col-xl-3">
                                        <div class="card-body">
                                            <button class="btn btn-primary w-100" id="btn-add-user" >
                                                <i class="ti ti-plus me-2 align-middle"></i> Add User
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="card-body pt-2">
                                <table id="responsive-datatable" class="table table-bordered table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>E-Mail</th>
                                            <th>Mobile</th>
                                            <th>Address</th>
                                            <th>Role</th>
                                            <th>Joining Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% users.forEach(function(user) { %>
                                            <tr>
                                                <td><%= user.name %></td>
                                                <td><%= user.email %></td>
                                                <td><%= user.mobile %></td>
                                                <td><%= user.address %></td>
                                                <td><%= user.role %></td>
                                                <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                                                <td>
                                                    <div class="btn-group" role="group">

                                                        <button class="btn btn-primary btn-sm btn-edit-role" data-user-id="<%= user.id %>">
                                                            <i class="mdi mdi-pencil"></i> Edit
                                                        </button>
                                                        <button type="button" class="btn btn-danger btn-sm ms-1 btn-user-delete" data-user-id="<%= user.id %>">
                                                            <i class="mdi mdi-delete"></i> Delete
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div> <!-- end row -->

                <!-- Add New Event MODAL -->
                <div class="modal fade" id="user-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/auth/user/register" id="user-form" class="needs-validation" novalidate method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title" id="modal-title">
                                        Add New User
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="name" class="form-label">Full Name</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="name" 
                                                  name="name" 
                                                  placeholder="Enter your full name"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide a valid name</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="email" class="form-label">Email</label>
                                                <input 
                                                  type="email" 
                                                  class="form-control" 
                                                  id="email" 
                                                  name="email" 
                                                  placeholder="Enter your email"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide a valid Email</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="user-mobile" class="control-label form-label">Mobile No.</label>
                                                <input 
                                                    class="form-control" 
                                                    placeholder="Insert Mobile Number" 
                                                    type="tel" 
                                                    id="user-mobile" 
                                                    name="mobile" 
                                                    required 
                                                />
                                                <div class="invalid-feedback">Please provide a valid Mobile Number</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="input-group">
                                              <input 
                                                type="hidden" 
                                                class="form-control" 
                                                id="password" 
                                                name="password" 
                                                placeholder="Create a password"
                                                required
                                              >
                                            </div>
                                        </div>
                                        <div class="col-12">
                                         <label for="confirmPassword" class="form-label text-danger" >Password Generating autometically. first word from the email address (before gmail.com) capital.Then last Four Digits of number.  </label>
                                         <input 
                                           type="hidden" 
                                           class="form-control" 
                                           id="confirmPassword" 
                                           name="confirmPassword" 
                                           placeholder="Confirm your password"
                                           required
                                         >
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="user-role" class="control-label form-label">Role</label>
                                                <select 
                                                    class="form-select" 
                                                    id="user-role" 
                                                    name="role" 
                                                    required
                                                >
                                                    <option value="">Choose Role</option>
                                                    <option value="admin">Admin</option>
                                                    <option value="user">User</option>
                                                </select>
                                                <div class="invalid-feedback">Please select a valid role</div>
                                                <input type="hidden" name="menupuletedby" value="<%= formData.id || '' %>">
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-danger" id="btn-delete-event">
                                            Delete
                                        </button>
                                    
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                    
                                        <button type="submit" class="btn btn-primary" id="btn-save-event">
                                            Save
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end modal-->

                <!-- Edit Modal -->
                 <div class="modal fade" id="role-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/auth/user/edit" id="user-form" class="needs-validation" novalidate method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title" id="modal-title">
                                        Add New User
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="user-role" class="control-label form-label">Role</label>
                                                <input type="hidden" name="menupuletedby" value="<%= formData.id || '' %>">
                                                <input type="hidden" name="userId" >
                                                <select 
                                                    class="form-select" 
                                                    id="user-role" 
                                                    name="role" 
                                                    required
                                                >
                                                    <option value="">Choose Role</option>
                                                    <option value="admin">Admin</option>
                                                    <option value="user">User</option>
                                                </select>
                                                <div class="invalid-feedback">Please select a valid role</div>
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-danger" id="btn-delete-event">
                                            Delete
                                        </button>
                                    
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                    
                                        <button type="submit" class="btn btn-primary" id="btn-save-event">
                                            Save
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="delete-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/auth/user/delete" id="user-form" class="needs-validation" novalidate method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title" id="modal-title">
                                        Add New User
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <!-- Delete warning UI -->
                                         <input type="hidden" name="userID">
                                        <div class="col-12 mb-3">
                                            <div class="alert alert-danger" role="alert">
                                                <div class="d-flex align-items-center">
                                                    <i class="ti ti-alert-triangle me-2 fs-3"></i>
                                                    <div>
                                                        <h5 class="alert-heading mb-1">Warning: Deletion Confirmation</h5>
                                                        <p class="mb-0">Are you sure you want to delete this item? This action cannot be undone.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light me-auto" data-bs-dismiss="modal">
                                            Cancel
                                        </button>
                                        <button type="submit" class="btn btn-danger" id="btn-delete-confirm">
                                            <i class="ti ti-trash me-1"></i> Yes, Delete
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                


            </div> <!-- container -->


            <%- include('../partials/footer.ejs') %>
            

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->

    <%- include('../partials/customizer.ejs') %>

    <%- include('../partials/footer-scripts.ejs') %>

    

    <!-- Datatable plugin js -->
    <script src="/backend/libs/datatables.net/js/dataTables.min.js"></script>
    <script src="/backend/libs/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>

    <script src="/backend/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="/backend/libs/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>

    <script src="/backend/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js"></script>

    <script src="/backend/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/buttons.print.min.js"></script>

    <script src="/backend/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="/backend/libs/datatables.net-select/js/dataTables.select.min.js"></script>

    <!-- Datatables init -->
    <script src="/backend/js/pages/table-datatable.js"></script>
    <script src="/backend/js/modal/newUser.js"></script>

</body>

</html>