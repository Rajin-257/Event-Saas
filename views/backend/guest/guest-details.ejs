<%- include('../partials/html.ejs') %>

<head>
    <%- include("../partials/title-meta.ejs", {title: "Guest Management"}) %>

    <link rel="stylesheet" href="/backend/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css">
    <link rel="stylesheet" href="/backend/libs/datatables.net-select-bs5/css/select.bootstrap5.min.css">

    <%- include('../partials/head-css.ejs') %>
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">

        <%- include('../partials/menu.ejs', {user: formData}) %>

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="page-content">

            <div class="page-container">

                <%- include("../partials/page-title.ejs", {subtitle:"Management", title:"Guest Directory"}) %>

                <%- include("../partials/validation-message.ejs") %>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-xl-6">
                                        <h5 class="card-title">Guest Management</h5>
                                        <p class="card-subtitle">
                                            Manage speakers, presenters, and special guests for your events.
                                        </p>
                                    </div>
                                    <div class="col-xl-6">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 mb-2 mb-md-0">
                                                    <button class="btn btn-primary w-100" id="btn-add-department">
                                                        <i class="ti ti-plus me-2 align-middle"></i>Add Department
                                                    </button>
                                                </div>
                                                <div class="col-md-6">
                                                    <button class="btn btn-primary w-100" id="btn-add-guest">
                                                        <i class="ti ti-plus me-2 align-middle"></i> Add Guest
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="card-body pt-2">
                                <table id="responsive-datatable" class="table table-bordered table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Picture</th>
                                            <th>Department</th>
                                            <th>Designation</th>
                                            <th>Organization</th>
                                            <th>Social Media</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% guests.forEach(function(guest) { %>
                                            <tr>
                                                <td><%= guest.name %></td>
                                                <td>
                                                    <% if (guest.picture) { %>
                                                        <img src="<%= guest.picture %>" alt="<%= guest.name %>" class="rounded avatar-sm">
                                                    <% } else { %>
                                                        <div class="avatar-sm">
                                                            <span class="avatar-title bg-primary rounded">
                                                                <%= guest.name.charAt(0) %>
                                                            </span>
                                                        </div>
                                                    <% } %>
                                                </td>
                                                <td><%= guest.departmentName || '-' %></td>
                                                <td><%= guest.designation || '-' %></td>
                                                <td><%= guest.organization || '-' %></td>
                                                <td>
                                                    <div class="d-flex gap-1">
                                                        <% if (guest.soc_youtube && guest.soc_youtube_status) { %>
                                                            <a href="<%= guest.soc_youtube %>" target="_blank" class="btn btn-sm btn-soft-danger">
                                                                <i class="mdi mdi-youtube"></i>
                                                            </a>
                                                        <% } %>
                                                        
                                                        <% if (guest.soc_fb && guest.soc_fb_status) { %>
                                                            <a href="<%= guest.soc_fb %>" target="_blank" class="btn btn-sm btn-soft-primary">
                                                                <i class="mdi mdi-facebook"></i>
                                                            </a>
                                                        <% } %>
                                                        
                                                        <% if (guest.soc_insta && guest.soc_insta_status) { %>
                                                            <a href="<%= guest.soc_insta %>" target="_blank" class="btn btn-sm btn-soft-warning">
                                                                <i class="mdi mdi-instagram"></i>
                                                            </a>
                                                        <% } %>
                                                        
                                                        <% if (guest.soc_tiktok && guest.soc_tiktok_status) { %>
                                                            <a href="<%= guest.soc_tiktok %>" target="_blank" class="btn btn-sm btn-soft-dark">
                                                                <i class="mdi mdi-music-note"></i>
                                                            </a>
                                                        <% } %>
                                                        
                                                        <% if (guest.soc_likee && guest.soc_likee_status) { %>
                                                            <a href="<%= guest.soc_likee %>" target="_blank" class="btn btn-sm btn-soft-info">
                                                                <i class="mdi mdi-thumb-up"></i>
                                                            </a>
                                                        <% } %>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group">
                                                        <button class="btn btn-primary btn-sm btn-edit-guest" data-guest-id="<%= guest.id %>">
                                                            <i class="mdi mdi-pencil"></i> Edit
                                                        </button>
                                                        <button type="button" class="btn btn-danger btn-sm ms-1 btn-guest-delete" data-guest-id="<%= guest.id %>">
                                                            <i class="mdi mdi-delete"></i> Delete
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div> <!-- end row -->

                <!-- Add New Guest MODAL -->
                <div class="modal fade" id="guest-modal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <form action="/settings/guests/create" id="guest-form" class="needs-validation" novalidate method="POST" enctype="multipart/form-data">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title" id="guest-modal-title">
                                        Add New Guest
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="guest-name" class="form-label">Name</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="guest-name" 
                                                  name="name" 
                                                  placeholder="Enter guest name"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide a name</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="guest-picture" class="form-label">Picture</label>
                                                <input 
                                                  type="file" 
                                                  class="form-control" 
                                                  id="guest-picture" 
                                                  name="picture" 
                                                  accept="image/*"
                                                >
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="guest-department" class="form-label">Department</label>
                                                <select 
                                                  class="form-select" 
                                                  id="guest-department" 
                                                  name="department"
                                                  required
                                                >
                                                  <option value="">Select Department</option>
                                                  <% departments.forEach(function(department) { %>
                                                    <option value="<%= department.id %>"><%= department.name %></option>
                                                  <% }); %>
                                                </select>
                                                <div class="invalid-feedback">Please select a department</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="guest-designation" class="form-label">Designation</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="guest-designation" 
                                                  name="designation" 
                                                  placeholder="Enter designation"
                                                >
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="guest-organization" class="form-label">Organization</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="guest-organization" 
                                                  name="organization" 
                                                  placeholder="Enter organization"
                                                >
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="guest-description" class="form-label">Description</label>
                                                <textarea 
                                                  class="form-control" 
                                                  id="guest-description" 
                                                  name="description" 
                                                  rows="3"
                                                  placeholder="Enter description"
                                                ></textarea>
                                            </div>
                                        </div>
                                        
                                        <!-- Social Media Section -->
                                        <div class="col-12 mb-3">
                                            <h5>Social Media Links</h5>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="soc_youtube_status" name="soc_youtube_status" checked>
                                                    </div>
                                                    <label for="soc_youtube" class="form-label mb-0">YouTube</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="soc_youtube" name="soc_youtube" placeholder="Enter YouTube link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="soc_fb_status" name="soc_fb_status" checked>
                                                    </div>
                                                    <label for="soc_fb" class="form-label mb-0">Facebook</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="soc_fb" name="soc_fb" placeholder="Enter Facebook link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="soc_insta_status" name="soc_insta_status" checked>
                                                    </div>
                                                    <label for="soc_insta" class="form-label mb-0">Instagram</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="soc_insta" name="soc_insta" placeholder="Enter Instagram link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="soc_tiktok_status" name="soc_tiktok_status" checked>
                                                    </div>
                                                    <label for="soc_tiktok" class="form-label mb-0">TikTok</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="soc_tiktok" name="soc_tiktok" placeholder="Enter TikTok link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="soc_likee_status" name="soc_likee_status" checked>
                                                    </div>
                                                    <label for="soc_likee" class="form-label mb-0">Likee</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="soc_likee" name="soc_likee" placeholder="Enter Likee link">
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Save Guest
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end guest modal-->

                <!-- Edit Guest MODAL -->
                <div class="modal fade" id="edit-guest-modal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <form action="/settings/guests/update/" id="edit-guest-form" class="needs-validation" novalidate method="POST" enctype="multipart/form-data">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title">
                                        Edit Guest
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="row">
                                        <input type="hidden" name="id" id="edit-guest-id">
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-guest-name" class="form-label">Name</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="edit-guest-name" 
                                                  name="name" 
                                                  placeholder="Enter guest name"
                                                  required
                                                >
                                                <div class="invalid-feedback">Please provide a name</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-guest-picture" class="form-label">Picture</label>
                                                <input 
                                                  type="file" 
                                                  class="form-control" 
                                                  id="edit-guest-picture" 
                                                  name="picture" 
                                                  accept="image/*"
                                                >
                                                <div id="current-picture-container" class="mt-2">
                                                    <span>Current Picture:</span>
                                                    <img id="current-picture" src="" alt="Current Picture" class="img-thumbnail" style="max-height: 100px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-guest-department" class="form-label">Department</label>
                                                <select 
                                                  class="form-select" 
                                                  id="edit-guest-department" 
                                                  name="department"
                                                  required
                                                >
                                                  <option value="">Select Department</option>
                                                  <% departments.forEach(function(department) { %>
                                                    <option value="<%= department.id %>"><%= department.name %></option>
                                                  <% }); %>
                                                </select>
                                                <div class="invalid-feedback">Please select a department</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-guest-designation" class="form-label">Designation</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="edit-guest-designation" 
                                                  name="designation" 
                                                  placeholder="Enter designation"
                                                >
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="edit-guest-organization" class="form-label">Organization</label>
                                                <input 
                                                  type="text" 
                                                  class="form-control" 
                                                  id="edit-guest-organization" 
                                                  name="organization" 
                                                  placeholder="Enter organization"
                                                >
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="mb-3">
                                                <label for="edit-guest-description" class="form-label">Description</label>
                                                <textarea 
                                                  class="form-control" 
                                                  id="edit-guest-description" 
                                                  name="description" 
                                                  rows="3"
                                                  placeholder="Enter description"
                                                ></textarea>
                                            </div>
                                        </div>
                                        
                                        <!-- Social Media Section -->
                                        <div class="col-12 mb-3">
                                            <h5>Social Media Links</h5>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="edit-soc_youtube_status" name="soc_youtube_status">
                                                    </div>
                                                    <label for="edit-soc_youtube" class="form-label mb-0">YouTube</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="edit-soc_youtube" name="soc_youtube" placeholder="Enter YouTube link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="edit-soc_fb_status" name="soc_fb_status">
                                                    </div>
                                                    <label for="edit-soc_fb" class="form-label mb-0">Facebook</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="edit-soc_fb" name="soc_fb" placeholder="Enter Facebook link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="edit-soc_insta_status" name="soc_insta_status">
                                                    </div>
                                                    <label for="edit-soc_insta" class="form-label mb-0">Instagram</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="edit-soc_insta" name="soc_insta" placeholder="Enter Instagram link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="edit-soc_tiktok_status" name="soc_tiktok_status">
                                                    </div>
                                                    <label for="edit-soc_tiktok" class="form-label mb-0">TikTok</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="edit-soc_tiktok" name="soc_tiktok" placeholder="Enter TikTok link">
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center">
                                                    <div class="form-check form-switch me-2">
                                                        <input class="form-check-input" type="checkbox" id="edit-soc_likee_status" name="soc_likee_status">
                                                    </div>
                                                    <label for="edit-soc_likee" class="form-label mb-0">Likee</label>
                                                </div>
                                                <input type="text" class="form-control mt-2" id="edit-soc_likee" name="soc_likee" placeholder="Enter Likee link">
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Update Guest
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end edit guest modal-->

                <!-- Delete Guest MODAL -->
                <div class="modal fade" id="delete-guest-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/settings/guests/delete/" id="delete-guest-form" method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title">
                                        Delete Guest
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <input type="hidden" name="id" id="delete-guest-id">
                                    <div class="alert alert-danger" role="alert">
                                        <div class="d-flex align-items-center">
                                            <i class="ti ti-alert-triangle me-2 fs-3"></i>
                                            <div>
                                                <h5 class="alert-heading mb-1">Warning: Deletion Confirmation</h5>
                                                <p class="mb-0">Are you sure you want to delete this guest? This action cannot be undone.</p>
                                            </div>
                                        </div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light me-auto" data-bs-dismiss="modal">
                                            Cancel
                                        </button>
                                        <button type="submit" class="btn btn-danger">
                                            <i class="ti ti-trash me-1"></i> Yes, Delete
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end delete guest modal-->

                <!-- Add Department MODAL -->
                <div class="modal fade" id="department-modal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form action="/settings/departments/create" id="department-form" class="needs-validation" novalidate method="POST">
                                <div class="modal-header p-3 border-bottom-0">
                                    <h5 class="modal-title" id="department-modal-title">
                                        Add New Department
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body px-3 pb-3 pt-0">
                                    <div class="mb-3">
                                        <label for="department-name" class="form-label">Department Name</label>
                                        <input 
                                          type="text" 
                                          class="form-control" 
                                          id="department-name" 
                                          name="name" 
                                          placeholder="Enter department name"
                                          required
                                        >
                                        <div class="invalid-feedback">Please provide a department name</div>
                                    </div>
                                
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <button type="button" class="btn btn-light ms-auto" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Save Department
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end department modal-->

            </div> <!-- container -->

            <%- include('../partials/footer.ejs') %>
            
        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->

    <%- include('../partials/customizer.ejs') %>

    <%- include('../partials/footer-scripts.ejs') %>


    <!-- Datatable plugin js -->
    <script src="/backend/libs/datatables.net/js/dataTables.min.js"></script>
    <script src="/backend/libs/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
    <script src="/backend/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="/backend/libs/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="/backend/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="/backend/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="/backend/libs/datatables.net-select/js/dataTables.select.min.js"></script>

    <!-- Datatables init -->
    <script src="/backend/js/pages/table-datatable.js"></script>
    
    <!-- Guest management scripts -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
    // Initialize datatables
    $('#responsive-datatable').DataTable({
        responsive: true,
        lengthMenu: [10, 25, 50, 100]
    });
    
    // Add Guest button functionality
    document.getElementById('btn-add-guest').addEventListener('click', function() {
        var guestModal = new bootstrap.Modal(document.getElementById('guest-modal'));
        guestModal.show();
    });
    
    // Add Department button functionality
    document.getElementById('btn-add-department').addEventListener('click', function() {
        var departmentModal = new bootstrap.Modal(document.getElementById('department-modal'));
        departmentModal.show();
    });
    
    // Edit Guest button functionality
    document.querySelectorAll('.btn-edit-guest').forEach(button => {
        button.addEventListener('click', function() {
            const guestId = this.getAttribute('data-guest-id');
            
            // Fetch guest details via AJAX
            fetch(`/settings/guests/${guestId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const guest = data.data;
                        
                        // Set form action URL
                        document.getElementById('edit-guest-form').action = `/settings/guests/update/${guestId}`;
                        
                        // Populate form fields
                        document.getElementById('edit-guest-id').value = guest.id;
                        document.getElementById('edit-guest-name').value = guest.name;
                        document.getElementById('edit-guest-designation').value = guest.designation || '';
                        document.getElementById('edit-guest-organization').value = guest.organization || '';
                        document.getElementById('edit-guest-description').value = guest.description || '';
                        
                        // Set department dropdown
                        document.getElementById('edit-guest-department').value = guest.department || '';
                        
                        // Social media fields
                        document.getElementById('edit-soc_youtube').value = guest.soc_youtube || '';
                        document.getElementById('edit-soc_fb').value = guest.soc_fb || '';
                        document.getElementById('edit-soc_insta').value = guest.soc_insta || '';
                        document.getElementById('edit-soc_tiktok').value = guest.soc_tiktok || '';
                        document.getElementById('edit-soc_likee').value = guest.soc_likee || '';
                        
                        // Social media status checkboxes
                        document.getElementById('edit-soc_youtube_status').checked = guest.soc_youtube_status;
                        document.getElementById('edit-soc_fb_status').checked = guest.soc_fb_status;
                        document.getElementById('edit-soc_insta_status').checked = guest.soc_insta_status;
                        document.getElementById('edit-soc_tiktok_status').checked = guest.soc_tiktok_status;
                        document.getElementById('edit-soc_likee_status').checked = guest.soc_likee_status;
                        
                        // Show current picture if exists
                        const pictureContainer = document.getElementById('current-picture-container');
                        const currentPicture = document.getElementById('current-picture');
                        
                        if (guest.picture) {
                            currentPicture.src = guest.picture;
                            pictureContainer.style.display = 'block';
                        } else {
                            pictureContainer.style.display = 'none';
                        }
                        
                        // Show modal
                        var editModal = new bootstrap.Modal(document.getElementById('edit-guest-modal'));
                        editModal.show();
                    } else {
                        alert('Error loading guest details');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to load guest details');
                });
        });
    });
    
    // Delete Guest button functionality
    document.querySelectorAll('.btn-guest-delete').forEach(button => {
        button.addEventListener('click', function() {
            const guestId = this.getAttribute('data-guest-id');
            
            // Set delete form action URL
            document.getElementById('delete-guest-form').action = `/settings/guests/delete/${guestId}`;
            document.getElementById('delete-guest-id').value = guestId;
            
            // Show delete confirmation modal
            var deleteModal = new bootstrap.Modal(document.getElementById('delete-guest-modal'));
            deleteModal.show();
        });
    });
    
    // Form validation
    const forms = document.querySelectorAll('.needs-validation');
    
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            form.classList.add('was-validated');
        }, false);
    });
});

</script>