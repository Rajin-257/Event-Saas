<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/title-meta', { title: title }) %>
    <%- include('../partials/head-css') %>
    
    <style>
        .event-header {
            position: relative;
            background-color: #f5f7fa;
            overflow: hidden;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .event-cover {
            height: 300px;
            width: 100%;
            object-fit: cover;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        
        .event-info-container {
            padding: 2rem;
        }
        
        .event-meta {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            color: #697a8d;
        }
        
        .event-meta i {
            margin-right: 0.5rem;
            font-size: 1rem;
        }
        
        .event-category {
            display: inline-block;
            font-size: 0.85rem;
            padding: 0.4rem 0.8rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
            text-transform: capitalize;
        }
        
        .category-concert { background-color: #e8f5e9; color: #2e7d32; }
        .category-seminar { background-color: #e3f2fd; color: #1565c0; }
        .category-workshop { background-color: #fff8e1; color: #ff8f00; }
        .category-conference { background-color: #f3e5f5; color: #7b1fa2; }
        .category-exhibition { background-color: #e0f7fa; color: #00838f; }
        .category-other { background-color: #f5f5f5; color: #616161; }
        
        .ticket-card {
            border: 1px solid #e0e0e0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .ticket-card:hover {
            border-color: #696cff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
        }
        
        .ticket-price {
            font-size: 1.5rem;
            font-weight: 600;
            color: #566a7f;
        }
        
        .ticket-limit {
            font-size: 0.875rem;
            color: #697a8d;
            margin-top: 0.5rem;
        }
        
        .speaker-card {
            height: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .speaker-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .speaker-image {
            height: 180px;
            object-fit: cover;
            width: 100%;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        
        .speaker-type {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .speaker-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .speaker-designation {
            font-size: 0.875rem;
            color: #697a8d;
            margin-bottom: 0.5rem;
        }
        
        .speaker-bio {
            font-size: 0.875rem;
            color: #697a8d;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .session-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #e0e0e0;
        }
        
        .venue-map {
            height: 300px;
            border-radius: 0.5rem;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <!-- Begin page -->
    <div class="wrapper">
        <%- include('../partials/menu') %>
        
        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->
        <div class="page-content">
            <div class="page-container">
                <!-- Page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                                    <li class="breadcrumb-item"><a href="/events">Events</a></li>
                                    <li class="breadcrumb-item active"><%= event.title %></li>
                                </ol>
                            </div>
                            <h4 class="page-title">Event Details</h4>
                        </div>
                    </div>
                </div>
                
                <!-- Flash messages -->
                <%- include('../partials/messages') %>
                
                <!-- Event header and details -->
                <div class="row">
                    <div class="col-12">
                        <div class="event-header">
                            <% if (event.bannerImage) { %>
                                <img src="<%= event.bannerImage %>" alt="<%= event.title %>" class="event-cover">
                            <% } else { %>
                                <img src="/assets/images/event-cover-placeholder.jpg" alt="<%= event.title %>" class="event-cover">
                            <% } %>
                            
                            <div class="event-info-container">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <span class="event-category category-<%= event.category %>">
                                            <%= event.category %>
                                        </span>
                                        
                                        <h2 class="mb-3"><%= event.title %></h2>
                                        
                                        <div class="event-meta mb-2">
                                            <i class="ri-calendar-event-line"></i>
                                            <span>
                                                <%= new Date(event.startDate).toLocaleDateString('en-US', { 
                                                    weekday: 'long', 
                                                    day: 'numeric', 
                                                    month: 'long', 
                                                    year: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                }) %>
                                                -
                                                <%= new Date(event.endDate).toLocaleDateString('en-US', { 
                                                    weekday: 'long', 
                                                    day: 'numeric', 
                                                    month: 'long', 
                                                    year: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                }) %>
                                            </span>
                                        </div>
                                        
                                        <div class="event-meta mb-2">
                                            <i class="ri-map-pin-line"></i>
                                            <span><%= event.venue %>, <%= event.venueAddress %></span>
                                        </div>
                                        
                                        <div class="event-meta mb-3">
                                            <i class="ri-user-3-line"></i>
                                            <span>Organized by <%= event.organizer ? event.organizer.name : 'Unknown' %></span>
                                        </div>
                                        
                                        <% if (locals.user && (locals.user.id === event.organizerId || locals.user.role === 'super_admin')) { %>
                                            <div class="mt-3">
                                                <a href="/events/<%= event.id %>/edit" class="btn btn-primary me-2">
                                                    <i class="ri-edit-box-line me-1"></i> Edit Event
                                                </a>
                                                <a href="/events/<%= event.id %>/speakers" class="btn btn-info me-2">
                                                    <i class="ri-user-voice-line me-1"></i> Manage Speakers
                                                </a>
                                                <a href="/tickets/events/<%= event.id %>/tickets" class="btn btn-secondary me-2">
                                                    <i class="ri-ticket-2-line me-1"></i> Manage Tickets
                                                </a>
                                                
                                            </div>
                                        <% } %>
                                    </div>
                                    
                                    <div class="col-lg-4">
                                        <div class="card border-0 bg-light">
                                            <div class="card-body">
                                                <h5 class="mb-3">Event Status</h5>
                                                
                                                <% 
                                                let statusClass = 'bg-info';
                                                let statusText = 'Upcoming';
                                                
                                                if (new Date(event.startDate) <= new Date() && new Date(event.endDate) >= new Date()) {
                                                    statusClass = 'bg-primary';
                                                    statusText = 'Ongoing';
                                                } else if (new Date(event.endDate) < new Date()) {
                                                    statusClass = 'bg-secondary';
                                                    statusText = 'Completed';
                                                } else if (event.status === 'cancelled') {
                                                    statusClass = 'bg-danger';
                                                    statusText = 'Cancelled';
                                                }
                                                %>
                                                
                                                <div class="d-flex align-items-center mb-3 justify-content-between">
                                                    <div class="flex-shrink-0">
                                                        <span class="badge <%= statusClass %> p-2">
                                                            <%= statusText %>
                                                        </span>
                                                    </div>
                                                
                                                    <div class="badge">
                                                        <% if (!event.isPublished) { %>
                                                            <form action="/events/<%= event.id %>/publish" method="POST" class="d-inline">
                                                                <button type="submit" class="btn btn-success">
                                                                    <i class="ri-send-plane-line me-1"></i> Publish
                                                                </button>
                                                            </form>
                                                        <% } else { %>
                                                            <form action="/events/<%= event.id %>/publish" method="POST" class="d-inline">
                                                                <button type="submit" class="btn btn-warning">
                                                                    <i class="ri-draft-line me-1"></i> Unpublish
                                                                </button>
                                                            </form>
                                                        <% } %>
                                                    </div>
                                                </div>
                                                
                                                
                                                <div class="d-grid gap-2">
                                                    <% if (ticketTypes && ticketTypes.length > 0 && statusText !== 'Completed' && statusText !== 'Cancelled') { %>
                                                        <a href="#tickets" class="btn btn-primary">
                                                            <i class="ri-ticket-2-line me-1"></i> Get Tickets
                                                        </a>
                                                    <% } else if (statusText === 'Completed') { %>
                                                        <button class="btn btn-secondary" disabled>
                                                            <i class="ri-time-line me-1"></i> Event Ended
                                                        </button>
                                                    <% } else if (statusText === 'Cancelled') { %>
                                                        <button class="btn btn-danger" disabled>
                                                            <i class="ri-close-circle-line me-1"></i> Event Cancelled
                                                        </button>
                                                    <% } else { %>
                                                        <button class="btn btn-secondary" disabled>
                                                            <i class="ri-ticket-2-line me-1"></i> Tickets Not Available
                                                        </button>
                                                    <% } %>
                                                    
                                                    <button type="button" class="btn btn-outline-primary" onclick="shareEvent()">
                                                        <i class="ri-share-line me-1"></i> Share Event
                                                    </button>
                                                    <a href="/tickets/events/<%= event.id %>/attendees" class="btn btn-primary">
                                                        <i class="ri-ticket-2-line me-1"></i> Attendees
                                                    </a>

                                                </div>
                                                
                                                <div class="mt-4">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <i class="ri-user-follow-line me-2"></i>
                                                        <span>Max Attendees: <%= event.maxAttendees %></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Event tabs -->
                <div class="row">
                    <div class="col-12">
                        <ul class="nav nav-tabs nav-bordered mb-3" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#about-tab" role="tab">About</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#speakers-tab" role="tab">Speakers</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#tickets-tab" role="tab" id="tickets">Tickets</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#venue-tab" role="tab">Venue</a>
                            </li>
                        </ul>
                        
                        <div class="tab-content">
                            <!-- About Tab -->
                            <div class="tab-pane show active" id="about-tab" role="tabpanel">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <h4 class="mb-3">About This Event</h4>
                                                
                                                <div class="mb-4">
                                                    <p><%= event.description %></p>
                                                </div>
                                                
                                                <h5 class="mb-3">Event Schedule</h5>
                                                
                                                <div class="table-responsive">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Time</th>
                                                                <th>Activity</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <%= new Date(event.startDate).toLocaleDateString('en-US', { 
                                                                        weekday: 'long', 
                                                                        day: 'numeric', 
                                                                        month: 'long', 
                                                                        year: 'numeric'
                                                                    }) %>
                                                                </td>
                                                                <td>
                                                                    <%= new Date(event.startDate).toLocaleTimeString('en-US', { 
                                                                        hour: '2-digit', 
                                                                        minute: '2-digit'
                                                                    }) %>
                                                                </td>
                                                                <td>Event Start</td>
                                                            </tr>
                                                            
                                                            <% if (event.speakers && event.speakers.length > 0) { %>
                                                                <% event.speakers.forEach(speaker => { %>
                                                                    <% if (speaker.sessionTime) { %>
                                                                        <tr>
                                                                            <td>
                                                                                <%= new Date(speaker.sessionTime).toLocaleDateString('en-US', { 
                                                                                    weekday: 'long', 
                                                                                    day: 'numeric', 
                                                                                    month: 'long', 
                                                                                    year: 'numeric'
                                                                                }) %>
                                                                            </td>
                                                                            <td>
                                                                                <%= new Date(speaker.sessionTime).toLocaleTimeString('en-US', { 
                                                                                    hour: '2-digit', 
                                                                                    minute: '2-digit'
                                                                                }) %>
                                                                            </td>
                                                                            <td>
                                                                                <strong><%= speaker.sessionTopic %></strong>
                                                                                <br>
                                                                                by <%= speaker.name %> (<%= speaker.speakerType %> speaker)
                                                                            </td>
                                                                        </tr>
                                                                    <% } %>
                                                                <% }); %>
                                                            <% } %>
                                                            
                                                            <tr>
                                                                <td>
                                                                    <%= new Date(event.endDate).toLocaleDateString('en-US', { 
                                                                        weekday: 'long', 
                                                                        day: 'numeric', 
                                                                        month: 'long', 
                                                                        year: 'numeric'
                                                                    }) %>
                                                                </td>
                                                                <td>
                                                                    <%= new Date(event.endDate).toLocaleTimeString('en-US', { 
                                                                        hour: '2-digit', 
                                                                        minute: '2-digit'
                                                                    }) %>
                                                                </td>
                                                                <td>Event End</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                
                                                <% if (event.cancellationPolicy) { %>
                                                    <h5 class="mt-4 mb-3">Cancellation Policy</h5>
                                                    <div class="alert alert-info">
                                                        <p><%= event.cancellationPolicy %></p>
                                                    </div>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Speakers Tab -->
                            <div class="tab-pane" id="speakers-tab" role="tabpanel">
                                <div class="row">
                                    <% if (speakers && speakers.length > 0) { %>
                                        <% speakers.forEach(speaker => { %>
                                            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                                                <div class="card speaker-card h-100">
                                                    <div class="position-relative">
                                                        <% if (speaker.photo) { %>
                                                            <img src="<%= speaker.photo %>" alt="<%= speaker.name %>" class="speaker-image">
                                                        <% } else { %>
                                                            <img src="/assets/images/speaker-placeholder.jpg" alt="<%= speaker.name %>" class="speaker-image">
                                                        <% } %>
                                                        
                                                        <div class="speaker-type">
                                                            <% 
                                                                let badgeClass = 'bg-info';
                                                                if (speaker.speakerType === 'keynote') badgeClass = 'bg-primary';
                                                                if (speaker.speakerType === 'panel') badgeClass = 'bg-warning';
                                                                if (speaker.speakerType === 'guest') badgeClass = 'bg-success';
                                                            %>
                                                            <span class="badge <%= badgeClass %>">
                                                                <%= speaker.speakerType %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="card-body">
                                                        <h5 class="speaker-name"><%= speaker.name %></h5>
                                                        
                                                        <% if (speaker.designation && speaker.organization) { %>
                                                            <p class="speaker-designation">
                                                                <%= speaker.designation %> at <%= speaker.organization %>
                                                            </p>
                                                        <% } else if (speaker.designation) { %>
                                                            <p class="speaker-designation">
                                                                <%= speaker.designation %>
                                                            </p>
                                                        <% } else if (speaker.organization) { %>
                                                            <p class="speaker-designation">
                                                                <%= speaker.organization %>
                                                            </p>
                                                        <% } %>
                                                        
                                                        <% if (speaker.bio) { %>
                                                            <p class="speaker-bio"><%= speaker.bio %></p>
                                                        <% } %>
                                                        
                                                        <% if (speaker.sessionTopic) { %>
                                                            <div class="session-details">
                                                                <strong>Session:</strong> <%= speaker.sessionTopic %>
                                                                
                                                                <% if (speaker.sessionTime) { %>
                                                                    <div class="mt-1">
                                                                        <i class="ti ti-arrow-right-to-arc"></i>
                                                                        <%= new Date(speaker.sessionTime).toLocaleString('en-US', { 
                                                                            month: 'short',
                                                                            day: 'numeric',
                                                                            hour: '2-digit', 
                                                                            minute: '2-digit'
                                                                        }) %>
                                                                        
                                                                        <% if (speaker.sessionDuration) { %>
                                                                            (<%= speaker.sessionDuration %> mins)
                                                                        <% } %>
                                                                    </div>
                                                                <% } %>
                                                            </div>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                        <% }); %>
                                    <% } else { %>
                                        <div class="col-12">
                                            <div class="text-center py-5">
                                                <img src="/assets/images/no-speakers.svg" alt="No speakers found" class="img-fluid mb-4" style="max-width: 200px;">
                                                <h4>No Speakers Listed</h4>
                                                <p class="text-muted">There are no speakers announced for this event yet.</p>
                                                
                                                <% if (locals.user && (locals.user.id === event.organizerId || locals.user.role === 'super_admin')) { %>
                                                    <a href="/events/<%= event.id %>/speakers" class="btn btn-primary mt-2">
                                                        <i class="ri-user-add-line me-1"></i> Add Speakers
                                                    </a>
                                                <% } %>
                                            </div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                            
                            <!-- Tickets Tab -->
                            <div class="tab-pane" id="tickets-tab" role="tabpanel">
                                <div class="row">
                                    <% if (ticketTypes && ticketTypes.length > 0) { %>
                                        <div class="col-lg-8">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h4 class="mb-4">Available Tickets</h4>
                                                    
                                                    <% ticketTypes.forEach(ticket => { %>
                                                        <div class="ticket-card">
                                                            <div class="row">
                                                                <div class="col-md-8">
                                                                    <h5 class="mb-1"><%= ticket.name %></h5>
                                                                    <p class="text-muted mb-0"><%= ticket.description %></p>
                                                                    
                                                                    <div class="mt-3">
                                                                        <% if (ticket.saleStartDate && ticket.saleEndDate) { %>
                                                                            <span class="badge bg-light text-dark">
                                                                                Sales: <%= new Date(ticket.saleStartDate).toLocaleDateString() %> - <%= new Date(ticket.saleEndDate).toLocaleDateString() %>
                                                                            </span>
                                                                        <% } %>
                                                                        
                                                                        <% if (ticket.maxTicketsPerUser) { %>
                                                                            <span class="badge bg-light text-dark ms-2">
                                                                                Max <%= ticket.maxTicketsPerUser %> per user
                                                                            </span>
                                                                        <% } %>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4 text-md-end">
                                                                    <div class="ticket-price">
                                                                        $<%= parseFloat(ticket.price).toFixed(2) %>
                                                                    </div>
                                                                    
                                                                    <% 
                                                                        let ticketStatus = 'Available';
                                                                        let ticketBtnClass = 'btn-primary';
                                                                        let ticketBtnDisabled = false;
                                                                        
                                                                        if (ticket.quantity <= 0) {
                                                                            ticketStatus = 'Sold Out';
                                                                            ticketBtnClass = 'btn-secondary';
                                                                            ticketBtnDisabled = true;
                                                                        } else if (ticket.saleStartDate && new Date(ticket.saleStartDate) > new Date()) {
                                                                            ticketStatus = 'Sale Starts ' + new Date(ticket.saleStartDate).toLocaleDateString();
                                                                            ticketBtnClass = 'btn-secondary';
                                                                            ticketBtnDisabled = true;
                                                                        } else if (ticket.saleEndDate && new Date(ticket.saleEndDate) < new Date()) {
                                                                            ticketStatus = 'Sale Ended';
                                                                            ticketBtnClass = 'btn-secondary';
                                                                            ticketBtnDisabled = true;
                                                                        }
                                                                    %>
                                                                    
                                                                    <div class="ticket-limit mb-3">
                                                                        <%= ticketStatus %>
                                                                    </div>
                                                                    
                                                                    <button class="btn <%= ticketBtnClass %>" 
                                                                            onclick="addToCart('<%= ticket.id %>')"
                                                                            >
                                                                        <i class="ri-shopping-cart-line me-1"></i> Buy Ticket
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <% }); %>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-lg-4">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="mb-3">Order Summary</h5>
                                                    <div id="cart-items">
                                                        <div class="text-center py-3">
                                                            <i class="ri-shopping-cart-line" style="font-size: 36px; opacity: 0.5;"></i>
                                                            <p class="mt-2">Your cart is empty</p>
                                                            <p class="text-muted">Add tickets to proceed</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% } else { %>
                                        <div class="col-12">
                                            <div class="text-center py-5">
                                                <img src="/assets/images/no-tickets.svg" alt="No tickets available" class="img-fluid mb-4" style="max-width: 200px;">
                                                <h4>No Tickets Available</h4>
                                                <p class="text-muted">Tickets for this event are not available yet.</p>
                                                
                                                <% if (locals.user && (locals.user.id === event.organizerId || locals.user.role === 'super_admin')) { %>
                                                    <a href="/tickets/events/<%= event.id %>/tickets/" class="btn btn-primary mt-2">
                                                        <i class="ri-ticket-2-line me-1"></i> Add Tickets
                                                    </a>
                                                <% } %>
                                            </div>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                            
                            <!-- Venue Tab -->
                            <div class="tab-pane" id="venue-tab" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h4 class="mb-3">Venue Details</h4>
                                                
                                                <h5 class="mb-2"><%= event.venue %></h5>
                                                <p class="mb-3"><%= event.venueAddress %></p>
                                                
                                                <div class="d-grid">
                                                    <a 
                                                        href="https://maps.google.com/?q=<%= encodeURIComponent(event.venue + ', ' + event.venueAddress) %>" 
                                                        target="_blank" 
                                                        class="btn btn-outline-primary">
                                                        <i class="ri-map-pin-line me-1"></i> Get Directions
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-6">
                                        <div class="card">
                                            <div class="card-body p-0">
                                                <div class="venue-map">
                                                    <iframe 
                                                        width="100%" 
                                                        height="100%" 
                                                        frameborder="0" 
                                                        style="border:0" 
                                                        src="https://maps.google.com/maps?q=<%= encodeURIComponent(event.venue + ', ' + event.venueAddress) %>&output=embed" 
                                                        allowfullscreen>
                                                    </iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
            <!-- container -->
            <%- include('../partials/footer') %>
        </div>
        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->
    </div>
    <!-- END wrapper -->

    <script>
        // Cart functionality
        const cart = {
            items: [],

            addItem: function(ticketId) {
                // Here you would normally fetch ticket details from the server
                // For now, we'll use the client-side approach for demonstration
                const ticketElm = document.querySelector(`button[onclick="addToCart('${ticketId}')"]`).closest('.ticket-card');
                const ticketName = ticketElm.querySelector('h5').textContent;

                // Fix: Properly extract the price number from the text
                const priceText = ticketElm.querySelector('.ticket-price').textContent.trim();
                const ticketPrice = parseFloat(priceText.replace('$', '').replace(',', ''));

                // Check if already in cart
                const existingItem = this.items.find(item => item.id === ticketId);
                if (existingItem) {
                    existingItem.qty += 1;
                } else {
                    this.items.push({
                        id: ticketId,
                        name: ticketName,
                        price: ticketPrice,
                        qty: 1
                    });
                }

                this.updateCart();
            },

            removeItem: function(ticketId) {
                this.items = this.items.filter(item => item.id !== ticketId);
                this.updateCart();
            },

            updateQuantity: function(ticketId, qty) {
                const item = this.items.find(item => item.id === ticketId);
                if (item) {
                    item.qty = parseInt(qty);
                    if (item.qty <= 0) {
                        this.removeItem(ticketId);
                    } else {
                        this.updateCart();
                    }
                }
            },

            updateCart: function() {
                const cartElm = document.getElementById('cart-items');

                if (this.items.length === 0) {
                    cartElm.innerHTML = `
                        <div class="text-center py-3">
                            <i class="ri-shopping-cart-line" style="font-size: 36px; opacity: 0.5;"></i>
                            <p class="mt-2">Your cart is empty</p>
                            <p class="text-muted">Add tickets to proceed</p>
                        </div>
                    `;
                    return;
                }

                let total = 0;
                let cartHtml = `
                    <div class="list-group mb-3">
                `;
                    
                this.items.forEach(item => {
                    const itemTotal = item.price * item.qty;
                    total += itemTotal;

                    cartHtml += `
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="mb-1">${item.name}</h6>
                                    <small class="text-muted">$${item.price.toFixed(2)} each</small>
                                </div>
                                <div class="text-end">
                                    <div class="mb-1">$${itemTotal.toFixed(2)}</div>
                                    <div class="d-flex align-items-center">
                                        <button type="button" class="btn btn-xs btn-outline-secondary" onclick="cart.updateQuantity('${item.id}', ${item.qty - 1})">
                                            -
                                        </button>
                                        <span class="mx-2">${item.qty}</span>
                                        <button type="button" class="btn btn-xs btn-outline-secondary" onclick="cart.updateQuantity('${item.id}', ${item.qty + 1})">
                                            +
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                cartHtml += `
                    </div>

                    <div class="d-flex justify-content-between mb-3">
                        <h5>Total</h5>
                        <h5>$${total.toFixed(2)}</h5>
                    </div>

                    <div class="d-grid">
                        <a href="/checkout?event=${event.id}" class="btn btn-primary">
                            <i class="ri-shopping-cart-2-line me-1"></i> Proceed to Checkout
                        </a>
                    </div>
                `;
                
                cartElm.innerHTML = cartHtml;
            }
        };

        // Add to cart function (exposed to global scope)
        function addToCart(ticketId) {
            cart.addItem(ticketId);
        }
    </script>

    <%- include('../partials/footer-scripts') %>
</body>
</html>